<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Registration</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome for eye icon + spinner -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body class="bg-gray-100 flex items-center justify-center h-screen">
  <!-- Success Modal -->
<div id="modalOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
  <div class="bg-white rounded shadow-lg max-w-sm w-full p-6">
    <h3 id="modalTitle" class="text-lg font-bold mb-4">Title</h3>
    <p id="modalMessage" class="mb-6">Message</p>
    <div class="flex justify-end">
      <button id="modalOkBtn" class="bg-pink-600 text-white px-4 py-2 rounded hover:bg-pink-700">OK</button>
    </div>
  </div>
</div>

  <div class="bg-white p-6 rounded shadow-md w-full max-w-md">
    <h2 class="text-2xl font-bold mb-4 text-center text-pink-600">Admin Registration</h2>

    <form id="adminLoginForm" class="space-y-4">

      <input type="text" id="adminName" placeholder="Full Name"
             class="w-full border p-2 rounded" required />

      <input type="email" id="adminEmail" placeholder="Email"
             class="w-full border p-2 rounded" required />

      <!-- Password + Eye toggle -->
      <div class="relative">
        <input type="password" id="adminPassword" placeholder="Password"
               class="w-full border p-2 rounded" required />
        <i id="toggleAdminPassword"
           class="fa fa-eye absolute right-3 top-3 text-gray-500 cursor-pointer"></i>
      </div>

      <!-- Register Button With Spinner -->
      <button id="registerBtn" type="submit"
        class="w-full bg-pink-600 text-white py-2 rounded hover:bg-pink-700 flex items-center justify-center gap-2">
        <span id="registerBtnText">Register</span>
        <span id="registerSpinner" class="hidden">
          <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
      </button>

      <p id="registerError" class="text-red-500 text-sm hidden"></p>

      <p class="mt-4 text-center text-sm">
        Already an Admin? <a href="admin-login.html" class="text-pink-600">Login</a>
      </p>

    </form>
  </div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
  // --- Admin Firebase config ---
  const adminFirebaseConfig = {
    apiKey: "AIzaSyAL-VE8puSjlcVwXPj_H-LBz1JXS2Iz4vc",
    authDomain: "e-commerce-admin-auth.firebaseapp.com",
    projectId: "e-commerce-admin-auth",
    storageBucket: "e-commerce-admin-auth.firebasestorage.app",
    messagingSenderId: "816965536848",
    appId: "1:816965536848:web:5ea18f3227f1ae63911555"
  };

  // Initialize Firebase (Admin)
  const adminApp =
    firebase.apps.find(app => app.name === "AdminApp") ||
    firebase.initializeApp(adminFirebaseConfig, "AdminApp");

  const adminAuth = adminApp.auth();
  const db = adminApp.firestore();

  const form = document.getElementById("adminLoginForm");
  const registerError = document.getElementById("registerError");
  const registerBtn = document.getElementById("registerBtn");
  const registerBtnText = document.getElementById("registerBtnText");
  const registerSpinner = document.getElementById("registerSpinner");

  // PASSWORD EYE TOGGLE
  const adminPassword = document.getElementById("adminPassword");
  const toggleAdminPassword = document.getElementById("toggleAdminPassword");

  toggleAdminPassword.addEventListener("click", () => {
    if (adminPassword.type === "password") {
      adminPassword.type = "text";
      toggleAdminPassword.classList.remove("fa-eye");
      toggleAdminPassword.classList.add("fa-eye-slash");
    } else {
      adminPassword.type = "password";
      toggleAdminPassword.classList.remove("fa-eye-slash");
      toggleAdminPassword.classList.add("fa-eye");
    }
  });

  // REGISTRATION LOGIC + LOADING
  document.addEventListener("DOMContentLoaded", () => {
    if (!form) return;

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      registerError.classList.add("hidden");

      // Activate loading UI
      registerBtn.disabled = true;
      registerBtn.classList.add("opacity-50", "cursor-not-allowed");
      registerBtnText.textContent = "Registering...";
      registerSpinner.classList.remove("hidden");

      const name = document.getElementById("adminName").value.trim();
      const email = document.getElementById("adminEmail").value.trim();
      const password = adminPassword.value;

      try {
        const userCredential =
          await adminAuth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;

        await db.collection("admins").doc(user.uid).set({
          name,
          email,
          role: "admin",
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          lastLogin: firebase.firestore.FieldValue.serverTimestamp()
        });

        await showModal("Admin registered successfully!");
  window.location.href = "admin-login.html";

      } catch (err) {
        console.error(err);
        registerError.textContent = err.message;
        registerError.classList.remove("hidden");

        // Reset loading UI
        registerBtn.disabled = false;
        registerBtn.classList.remove("opacity-50", "cursor-not-allowed");
        registerBtnText.textContent = "Register";
        registerSpinner.classList.add("hidden");
      }
    });
  });

  // Optional auto-login redirect
  adminAuth.onAuthStateChanged(async (user) => {
    if (user && window.location.pathname.includes('admin-login.html')) {
      const storedUID = localStorage.getItem("adminUID");
      if (storedUID === user.uid) {
        const adminDoc = await db.collection("admins").doc(user.uid).get();
        if (adminDoc.exists) window.location.href = "Admins.html";
      }
    }
  });

  // ===== MODAL UTILS =====
const modalOverlay = document.getElementById("modalOverlay");
const modalTitle = document.getElementById("modalTitle");
const modalMessage = document.getElementById("modalMessage");
const modalOkBtn = document.getElementById("modalOkBtn");

function showModal(message, title = "Success") {
  modalTitle.textContent = title;
  modalMessage.textContent = message;
  modalOverlay.classList.remove("hidden");

  return new Promise(resolve => {
    modalOkBtn.onclick = () => {
      modalOverlay.classList.add("hidden");
      resolve(true);
    };
  });
}
</script>
</body>
</html>
